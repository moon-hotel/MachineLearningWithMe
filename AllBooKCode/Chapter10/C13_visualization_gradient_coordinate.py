import numpy as np
import matplotlib.pyplot as plt


def f_grad2(W1, W2, descent=True):
    grad = -np.array([2. * W1 - W2 - 1, 9 * W2 - W1 + 4.])
    if descent:
        grad *= -1
    learning_rate = 0.05
    return learning_rate * grad


def cost(W1, W2):
    J = (1 / 2) * (W1 - 1) ** 2 + (2 * W2 + 1) ** 2 + (1 / 2) * (W1 - W2) ** 2
    return -J


def plot_countour():
    W1 = np.arange(-4, 4, 0.25)
    W2 = np.arange(-4, 4, 0.25)
    W1, W2 = np.meshgrid(W1, W2)
    plt.figure(figsize=(8, 8), dpi=80)
    plt.rcParams['ytick.direction'] = 'in'  # 刻度向内
    plt.rcParams['xtick.direction'] = 'in'  # 刻度向内
    J = cost(W1, W2)
    CS = plt.contour(W1, W2, J, 16)
    plt.clabel(CS, inline=2, fontsize=10)
    plt.annotate(r'$(0.26,-0.41)$', xy=(-0.6, -0.9), fontsize=15)
    plt.xlabel(r'$w_1$', fontsize=18)
    plt.ylabel(r'$w_2$', fontsize=18)

    # --------------  坐标下降算法
    p = np.array([-3.8, 2.])  # 起始位置
    q = np.array([0., 0.])  # 初始化
    plt.scatter(p[0], p[1])
    print(f"坐标下降：")
    j = 0
    for i in range(50):
        q[0] = 0.5 * (p[1] + 1)  # 计算第1个维度
        plt.arrow(p[0], p[1], q[0] - p[0], 0., head_width=0.1, head_length=0.1, )
        p[0] = q[0]
        print("P{}:{}, J={}".format(j, p, cost(p[0], p[1])))
        j += 1
        q[1] = (1 / 9.) * (p[0] - 4.)  # 计算第2个维度
        plt.arrow(p[0], p[1], 0., q[1] - p[1], head_width=0.1, head_length=0.1, )
        p[1] = q[1]
        print("P{}:{}, J={}".format(j, p, cost(p[0], p[1])))
        j += 1
    #
    # # ------------  梯度下降算法
    print(f"梯度下降：")
    p = np.array([-3.8, 2.])  # 起始位置
    plt.scatter(p[0], p[1])
    for i in range(50):  #
        q = f_grad2(p[0], p[1], descent=False)
        plt.arrow(p[0], p[1], q[0], q[1], head_width=0.1, head_length=0.1, )
        p += q  # 上一次的位置加上本次的梯度
        print("P{}:{}, J={}".format(i, p, cost(p[0], p[1])))
    plt.show()


if __name__ == '__main__':
    plot_countour()
    print(cost(5 / 17, -7 / 17))

    # 坐标下降：
    # P0:[1.5 2. ], J=-25.25
    # P1:[ 1.5        -0.27777778], J=-1.9027777777777777
    # P2:[ 0.36111111 -0.27777778], J=-0.6057098765432098
    # P3:[ 0.36111111 -0.40432099], J=-0.5336505486968449
    # P4:[ 0.29783951 -0.40432099], J=-0.5296472527053802
    # P5:[ 0.29783951 -0.41135117], J=-0.5294248473725212
    # P6:[ 0.29432442 -0.41135117], J=-0.5294124915206956
    # P7:[ 0.29432442 -0.41174173], J=-0.5294118050844832
    # P8:[ 0.29412913 -0.41174173], J=-0.5294117669491379
    # P9:[ 0.29412913 -0.41176343], J=-0.5294117648305077
    # P10:[ 0.29411829 -0.41176343], J=-0.5294117647128058
    # P11:[ 0.29411829 -0.41176463], J=-0.5294117647062669
    # P12:[ 0.29411768 -0.41176463], J=-0.5294117647059038
    # P13:[ 0.29411768 -0.4117647 ], J=-0.5294117647058835
    # P14:[ 0.29411765 -0.4117647 ], J=-0.5294117647058825
    # P15:[ 0.29411765 -0.41176471], J=-0.5294117647058824
    # P16:[ 0.29411765 -0.41176471], J=-0.5294117647058822
    # P17:[ 0.29411765 -0.41176471], J=-0.5294117647058825
    # P18:[ 0.29411765 -0.41176471], J=-0.5294117647058825
    # P19:[ 0.29411765 -0.41176471], J=-0.5294117647058824
    # P20:[ 0.29411765 -0.41176471], J=-0.5294117647058824
    # P21:[ 0.29411765 -0.41176471], J=-0.5294117647058824
    # P22:[ 0.29411765 -0.41176471], J=-0.5294117647058825
    # ......
    # 梯度下降：
    # P0:[-3.27  0.71], J=-22.893049999999995
    # P1:[-2.8575  0.027 ], J=-12.711239249999995
    # P2:[-2.5204   -0.328025], J=-8.718163752812497
    # P3:[-2.23476125 -0.50643375], J=-6.725563718435154
    # P4:[-1.98660681 -0.59027662], J=-5.467378598583159
    # P5:[-1.76745996 -0.62398248], J=-4.544674319236992
    # P6:[-1.57191309 -0.63156336], J=-3.8187329515447535
    # P7:[-1.39629995 -0.62595551], J=-3.2313011630058335
    # P8:[-1.23796773 -0.61409053], J=-2.750927755180892
    # P9:[-1.09487548 -0.59964818], J=-2.356595723695313
    # P10:[-0.96537034 -0.58455027], J=-2.032447250911918
    # P11:[-0.84806082 -0.56977117], J=-1.7658590313884965
    # P12:[-0.7417433  -0.55577718], J=-1.546570934072641
    # P13:[-0.64535783 -0.54276462], J=-1.3661791241439507
    # P14:[-0.55796028 -0.53078843], J=-1.2177809751032076
    # P15:[-0.47870367 -0.51983165], J=-1.0957012044971932
    # P16:[-0.40682489 -0.50984259], J=-0.995271959383236
    # P17:[-0.34163453 -0.50075467], J=-0.9126534893274442
    # P18:[-0.28250881 -0.49249679], J=-0.8446870901252685
    # P19:[-0.22888277 -0.48499868], J=-0.7887742652943079
    # P20:[-0.18024442 -0.47819341], J=-0.742777358462192
    # P21:[-0.13612965 -0.4720186 ], J=-0.7049378201952069
    # ......